<!DOCTYPE HTML>
<html>
<head>
    <title>Programming Sample: Satoyama Dice AI - Robert Gervais Portfolio</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
</head>
<body class="is-preload">

    <div id="wrapper">

        <header id="header">
            <a href="index.html" class="logo"><strong>Robert Gervais</strong> <span>Portfolio</span></a>
            <nav>
                <a href="#menu">Menu</a>
            </nav>
        </header>

        <nav id="menu">
            <ul class="links">
                <li><a href="index.html">Home</a></li>
                <li><a href="landing.html">Samples</a></li>
                <li><a href="programming-samples-overview.html">Programming Samples</a></li>
                <li><a href="elements.html">Elements</a></li>
            </ul>
            <ul class="actions stacked">
                <li><a href="#" class="button primary fit">Get Started</a></li>
                <li><a href="#" class="button fit">Log In</a></li>
            </ul>
        </nav>

        <div id="main" class="alt">

            <section id="one">
                <div class="inner">
                    <header class="major">
                        <h1>Satoyama Dice</h1>
                    </header>

                    <span class="image main"><img src="images/satoyama-dice-by-robert-gervais.jpg" alt="Image: Robert Gervais" /></span>

                    <h2>Project Goal</h2>
                    <p>This sample demonstrates the AI architecture for my LÖVE2D game, "Satoyama Dice." The primary goal was to create a challenging and fair CPU opponent that could analyze the 6x6 Sudoku-like game board, make strategic decisions, and use the same game mechanics available to the player (placing dice, using items, re-rolling).</p>
                    <p><strong>Tools/Languages:</strong> <strong>LÖVE2D (Lua)</strong>, <strong>State Machines</strong>, <strong>Heuristic-Based Decision Making</strong>, and the <strong>Strategy Pattern</strong>.</p>

                    <h2>Technical Highlights</h2>
                    <ul>
                        <li><strong>Decoupled State Machine:</strong> The AI (<code>sd_ai.lua</code>) runs as a self-contained module with its own state (e.g., <code>isTurn</code>, <code>thinkingTime</code>, <code>pendingAction</code>). It's driven by the main game state (<code>sd_satoplay.lua</code>) but doesn't tangle with its logic.</li>
                        <li><strong>Clean Interface:</strong> The AI requests read-only game state via accessor functions (e.g., <code>playState.getGrid()</code>, <code>playState.getDiceValues()</code>) and sends its chosen move as a simple data table (e.g., <code>{type = "PLACE_ON_GRID", ...}</code>). The game state then executes the action via <code>playState.performAiAction(action)</code>.</li>
                        <li><strong>Pluggable Strategy Pattern:</strong> The AI's "brain" is not hard-coded. It delegates its decision to a <code>currentStrategy</code> module (<code>aiModule.currentStrategy:execute(gameState)</code>), allowing different AI "personalities" (e.g., Beginner, Aggressive, Heuristic) to be easily swapped.</li>
                        <li><strong>Tiered Heuristic Logic:</strong> The core solver (<code>sd_ai_helper.lua</code>) uses a 3-tier heuristic to find strategic moves, mimicking human problem-solving: it first looks for "Naked Singles," then "Hidden Singles," and finally falls back to a brute-force correct move if no simple strategy is found.</li>
                        <li><strong>"Thought" Visualization:</strong> The AI renders its analysis (potential moves, scores) to a separate LÖVE canvas (<code>aiModule.thoughtCanvas</code>). This provides an excellent debugging tool and a player-facing "show thoughts" feature.</li>
                        <li><strong>Knowledge & Memory:</strong> The AI reacts to game events, such as player hints, and stores that information in a temporary "memory" (<code>revealedHintCells</code>, <code>hintKnowledgeTimer</code>) to make smarter short-term decisions.</li>
                    </ul>

                    <h2>Code Snippets</h2>
                    <p>The AI system is split into three main parts: the AI "brain" (state machine), the game state "actuator" (interface), and the "solver" (heuristic logic). Below are key snippets from each.</p>

                    <h3>Snippet 1: The AI Brain's Turn</h3>
                    <p>This function is the entry point for the AI's turn. It gathers all necessary data from the game, delegates the <em>decision</em> to its strategy module, and then stores the resulting <code>chosenAction</code> to be executed after a "thinking" delay.</p>
                    <pre><code>-- Excerpt from sd_ai.lua
function aiModule.startTurn(playState, cellSize)
    aiModule.isTurn = true
    aiModule.thinkingTime = 1.5 -- Simulate "thinking"
    aiModule.showThoughts = true

    -- Get all necessary game state information
    local gameState = {
        grid = playState.getGrid(),
        diceValues = playState.getDiceValues(),
        hint = playState.getHint(),
        solution = playState.getSolution(),
        revealedCells = aiModule.revealedHintCells,
        cpuBombs = playState.getCPUBombs(),
        cpuBullseyes = playState.getCPUBullseyes(),
        canReroll = playState.getCanRerollCPU()
    }

    -- DELEGATE the decision to the current strategy
    local chosenAction, moveVisuals = aiModule.currentStrategy:execute(gameState)
    aiModule.pendingAction = chosenAction -- Store the action

    -- Draw the AI's thoughts to the canvas (simplified)
    love.graphics.setCanvas(aiModule.thoughtCanvas)
    love.graphics.clear()
    if moveVisuals then
        -- (Logic to draw scores and highlights on the canvas)
    end
    love.graphics.setCanvas()
end</code></pre>

                    <h3>Snippet 2: The Game's AI Interface</h3>
                    <p>This function in the main play state file receives the simple action table from the AI module. It acts as the "actuator," translating the AI's intention into actual game state changes, like placing a tile or re-rolling.</p>
                    <pre><code>-- Excerpt from sd_satoplay.lua (AI Interface)
function satoPlayState.performAiAction(action)
    if not action then
        turnState.isCPUTurn, turnState.cpuTurnPhase = false, 'none'
        return
    end

    if action.type == "PLACE_ON_GRID" then
        placeTileOnGrid(action.row, action.col, action.diceValue, true)
        turnState.isCPUTurn, turnState.cpuTurnPhase = false, 'none'
    
    elseif action.type == "SPEND_HINT" then
        local revealedCells = {}
        for r = 1, GRID_SIZE do
            for c = 1, GRID_SIZE do
                if not gridTiles[r][c] and solution[r][c] == action.value then
                    table.insert(revealedCells, {row = r, col = c})
                end
            end
        end
        
        -- Give the AI "knowledge" of the revealed cells
        aiModule.registerHintKnowledge(revealedCells, 15)
        cpuHintState.grid = {nil, nil}
        turnState.isCPUTurn, turnState.cpuTurnPhase = false, 'none'
    
    elseif action.type == "RE-ROLL" then
        if turnState.canReroll_cpu then
            -- (Roll dice logic...)
            turnState.cpuTurnPhase = 'rolling'
            return true -- Tell the update loop the turn continues
        end
    
    -- (Other actions like USE_BOMB, CREATE_BULLSEYE, etc.)
    end
end</code></pre>

                    <h3>Snippet 3: The 3-Tier Heuristic Solver</h3>
                    <p>This is the core "solver" logic used by the Heuristic strategy. It demonstrates a tiered approach to finding a move, starting with the simplest (and most human-like) Sudoku strategies before resorting to a brute-force solution.</p>
                    <pre><code>-- Excerpt from sd_ai_helper.lua
function aiHelper.getStrategicHint(grid, solution)
    -- Tier 1: Find "Naked Single" (only choice in a row/col/box).
    local hint = findOnlyChoice(grid, solution)
    if hint then
        return hint
    end

    -- Tier 2: Find "Hidden Single" (last remaining cell for a number).
    hint = findLastRemaining(grid, solution)
    if hint then
        return hint
    end

    -- Tier 3: If all strategic checks fail, find any correct move.
    hint = findAnyCorrectMove(grid, solution)
    if hint then
        return hint
    end

    return nil
end</code></pre>


                    <h2>Conclusion</h2>
                    <p>This AI architecture proved to be robust, maintainable, and easily extensible. By separating the AI's state, decision-making logic, and game-world interface, I could add new AI behaviors (like using new items) without refactoring the entire system. View the algorithm here.</p>
                    <ul class="actions">
                        <li><a href="samples/robert-gervais-ai-helper-algorithm.pdf" class="button primary icon brands fa-download">View Algorithm (PDF)</a></li>
                        <li><a href="programming-samples-overview.html" class="button">Back to Programming Samples</a></li>
                    </ul>
                </div>
            </section>

        </div>

        <footer id="footer">
            <div class="inner">
                <ul class="icons">
                    <li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
                    <li><a href="#" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
                    <li><a href="#" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
                    <li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
                    <li><a href="#" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
                </ul>
                <ul class="copyright">
                    <li>&copy; Robert Gervais</li>
                    <li>Design: <a href="https://html5up.net">HTML5 UP</a></li>
                </ul>
            </div>
        </footer>

    </div>

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

</body>
</html>